<mxfile host="app.diagrams.net" modified="2020-09-22T06:07:56.168Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36" etag="PptoTnTtjJmw-KblCe9R" version="13.1.1" type="github">
  <diagram id="c0VlTftgPbjmLoMzFiRr" name="Page-1">
    <mxGraphModel dx="2066" dy="1057" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="wSj1jjYBSh8IoZhMe18f-2" value="Coord" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="257" y="237" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-3" value="Coord" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="527" y="237" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-5" value="" style="endArrow=none;dashed=1;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="487" y="717" as="sourcePoint" />
            <mxPoint x="487" y="126.99999999999989" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-7" value="Remote DC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="617" y="127" width="83" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-8" value="Local DC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="292" y="127" width="58" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-9" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="467" y="87" as="sourcePoint" />
            <mxPoint x="377" y="227" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-11" value="POST media/test.jpg" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="332" y="77" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-31" value="Replication Queues" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="600" y="587" width="47" height="123" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-32" value="Replication Queues" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="437" width="41" height="123" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-35" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="327" y="307" as="sourcePoint" />
            <mxPoint x="327" y="387" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-39" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="307" y="357" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-57" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="407" y="267" as="sourcePoint" />
            <mxPoint x="517" y="267" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-59" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="452" y="247" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-61" value="SN" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="318" y="400" width="30" height="50" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-62" value="SN" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="328" y="410" width="30" height="50" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-64" value="SN" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="567" y="402" width="30" height="50" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-65" value="SN" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="577" y="412" width="30" height="50" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-67" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="577" y="307" as="sourcePoint" />
            <mxPoint x="577" y="387" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-68" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="557" y="367" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-69" value="" style="endArrow=classic;html=1;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="602" y="307" as="sourcePoint" />
            <mxPoint x="602" y="387" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-70" value="4" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="607" y="367" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-71" value="" style="endArrow=classic;html=1;dashed=1;entryX=0.91;entryY=0.011;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="wSj1jjYBSh8IoZhMe18f-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="737" y="527" as="sourcePoint" />
            <mxPoint x="517" y="357" as="targetPoint" />
            <Array as="points">
              <mxPoint x="737" y="588" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-72" value="6" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="657" y="567" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-79" value="" style="endArrow=classic;html=1;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="347" y="307" as="sourcePoint" />
            <mxPoint x="347" y="387" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-80" value="8" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="347" y="377" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-81" value="" style="endArrow=classic;html=1;dashed=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" target="wSj1jjYBSh8IoZhMe18f-32" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="277" y="312" as="sourcePoint" />
            <mxPoint x="212" y="450" as="targetPoint" />
            <Array as="points">
              <mxPoint x="277" y="337" />
              <mxPoint x="191" y="337" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-84" value="MH" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="352" y="587" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-85" value="MH" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="597" y="527" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-88" value="" style="endArrow=classic;html=1;dashed=1;entryX=1;entryY=0;entryDx=0;entryDy=0;rounded=1;" parent="1" target="wSj1jjYBSh8IoZhMe18f-85" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="607" y="347" as="sourcePoint" />
            <mxPoint x="647" y="582" as="targetPoint" />
            <Array as="points">
              <mxPoint x="737" y="347" />
              <mxPoint x="737" y="527" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-91" value="" style="endArrow=classic;html=1;dashed=1;entryX=1;entryY=0;entryDx=0;entryDy=0;rounded=1;" parent="1" target="wSj1jjYBSh8IoZhMe18f-84" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="347" y="367" as="sourcePoint" />
            <mxPoint x="427" y="577" as="targetPoint" />
            <Array as="points">
              <mxPoint x="437" y="367" />
              <mxPoint x="437" y="587" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-92" value="pkey: media/test.jpg&lt;br&gt;lkey: DC1: {hash-algorithm: X,&lt;br&gt;MD5: Y}&amp;nbsp;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="267" y="517" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-93" value="Note:&lt;br&gt;1. Primary Coord (for example, PDXA) receives a POST call from customer&lt;br&gt;2. Primary Coord issues 3 concurrent POST calls (same to the original request) to 1 local SN and 2 secondary Coords (SMF1 and ATLA)&lt;br&gt;&lt;div&gt;&lt;span&gt;3. Secondary Coord writes 1 copy to normal NS with original request. If successful, jump to step 7 and return 200.&lt;/span&gt;&lt;/div&gt;4. If step 3 fails, Coord writes 1 copy to alias NS with enough rehash&lt;br&gt;5. If step 4 succeeds, Coord inserts a new DC specific LKEY under the original blob PKEY to MH to indicate hash algorithm and MD5&lt;br&gt;6. If step 5 succeeds, Coord enqueues a write repair message for BRW to fix. If any of step 4 or 5 or 6 fails, jump to step 7 and return 503&lt;br&gt;7. Secondary Coord returns the result to primary Coord. If there&#39;s 1 successful copy then it&#39;ll be a 200. Otherwise 503.&lt;br&gt;&lt;br&gt;Among the 3 writes in step 2,&lt;br&gt;&amp;nbsp; - if all 3 succeed, return 200 to the customer&lt;br&gt;&amp;nbsp; - if 2 of 3 succeed, return 200 to the customer and Primary Coord enqueues either a xDC message if one of the remote write fails or a write repair message if the local one fails&lt;br&gt;&amp;nbsp; - if 1 of 3 succeeds, follow step 8&lt;br&gt;&lt;br&gt;8. Primary Coord writes 1 copy to alias NS with enough rehash&lt;br&gt;9. If step 8 succeeds, Primary Coord inserts a new DC specific LKEY under the original blob PKEY to MH to indicate hash algorithm and MD5&lt;br&gt;10. If any of step 8 or 9 fails, return 503 to the customer. If step 9 succeeds, return 200 to the customer and&amp;nbsp;Primary Coord inserts 2 messages to Kafka based on the status of local write in step 2&lt;br&gt;&amp;nbsp; &amp;nbsp; 10.1 If local write succeeds, enqueue 2 xDC message&lt;br&gt;&amp;nbsp; &amp;nbsp; 10.2 If local write fails, enqueue 1 write repair message and 1 xDC message" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="17" y="877" width="775" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-94" value="5" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="657" y="507" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-101" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="517" y="277" as="sourcePoint" />
            <mxPoint x="407" y="277" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-103" value="7" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="452" y="277" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-117" value="&lt;font style=&quot;font-size: 9px&quot;&gt;POST blob_prvt/media/test.jpg&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="597" y="307" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-136" value="Customer" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="447" y="30" width="80" height="47" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-137" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="387" y="237" as="sourcePoint" />
            <mxPoint x="487" y="87" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-138" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="402" y="137" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-139" value="&lt;font style=&quot;font-size: 9px&quot;&gt;POST blob_prvt/media/test.jpg&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="342" y="317" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-140" value="10" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="437" y="157" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wSj1jjYBSh8IoZhMe18f-143" value="9" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="407" y="567" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-1" value="" style="endArrow=none;dashed=1;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="130" y="717" as="sourcePoint" />
            <mxPoint x="130" y="127" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-2" value="Remote DC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="10" y="127" width="83" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-3" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="93" y="261.58" as="sourcePoint" />
            <mxPoint x="240" y="262" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-4" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="138" y="241.58" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-5" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="272" as="sourcePoint" />
            <mxPoint x="93" y="271.58" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-6" value="7" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="138" y="272" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-7" value="......" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="31.5" y="257" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jP_qFWJfhRR2PyRuPsTy-9" value="pkey: media/test.jpg&lt;br&gt;lkey: DC2: {hash-algorithm: X,&lt;br&gt;MD5: Y}&amp;nbsp;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="497" y="477" width="180" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
